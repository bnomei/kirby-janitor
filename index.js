(()=>{(function(){"use strict";var p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"janitor-wrapper"},[n("k-button",{class:["janitor",t.button.state],attrs:{id:t.id,icon:t.currentIcon,command:t.command,disabled:!t.unsaved&&!t.isUnsaved&&t.hasChanges},on:{click:t.runJanitor}},[t._v(" "+t._s(t.button.label||t.label)+" ")]),n("a",{directives:[{name:"show",rawName:"v-show",value:t.downloadRequest,expression:"downloadRequest"}],ref:"downloadAnchor",staticClass:"visually-hidden",attrs:{href:t.downloadRequest,download:""}}),n("a",{directives:[{name:"show",rawName:"v-show",value:t.urlRequest,expression:"urlRequest"}],ref:"tabAnchor",staticClass:"visually-hidden",attrs:{href:t.urlRequest,target:"_blank"}})],1)},m=[],q="";function v(t,e,n,c,o,r,l,u){var s=typeof t=="function"?t.options:t;e&&(s.render=e,s.staticRenderFns=n,s._compiled=!0),c&&(s.functional=!0),r&&(s._scopeId="data-v-"+r);var i;if(l?(i=function(a){a=a||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!a&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(a=__VUE_SSR_CONTEXT__),o&&o.call(this,a),a&&a._registeredComponents&&a._registeredComponents.add(l)},s._ssrRegister=i):o&&(i=u?function(){o.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:o),i)if(s.functional){s._injectStyles=i;var R=s.render;s.render=function(k,b){return i.call(b),R(k,b)}}else{var f=s.beforeCreate;s.beforeCreate=f?[].concat(f,i):[i]}return{exports:t,options:s}}const h="janitor.runAfterAutosave",g={props:{autosave:Boolean,clipboard:Boolean,confirm:String,command:String,cooldown:Number,data:String,error:String,icon:{type:[Boolean,String],default:!1},intab:Boolean,label:String,progress:String,success:String,status:String,unsaved:Boolean},data(){return{button:{label:null,state:null},clipboardRequest:null,downloadRequest:null,icons:{"is-running":"janitorLoader","is-success":"check","has-error":"alert"},isUnsaved:!1,urlRequest:null}},computed:{currentIcon(){var t;return(t=this.icons[this.status])!=null?t:this.icon},id(){var t;return"janitor-"+this.hashCode(this.command+((t=this.button.label)!=null?t:"")+this.label)},hasChanges(){return this.$store.getters["content/hasChanges"]()}},created(){this.$events.$on("model.update",()=>sessionStorage.getItem(h)&&location.reload()),sessionStorage.getItem(h)===this.id&&(sessionStorage.removeItem(h),this.runJanitor())},methods:{hashCode(t){let e=0;if(t.length===0)return e;for(const n of t)e=(e<<5)-e+t.charCodeAt(n),e=e&e;return e},async runJanitor(){if(!(this.confirm&&!window.confirm(this.confirm))){if(this.autosave&&this.hasChanges){const t=document.querySelector(".k-panel .k-form-buttons .k-view").lastChild;if(t){this.isUnsaved=!1,sessionStorage.setItem(h,this.id),this.simulateClick(t);return}}if(this.clipboardRequest){await this.copyToClipboard(this.clipboardRequest),this.resetButton(),this.clipboardRequest=null;return}this.status||this.getRequest("plugin-janitor/"+encodeURIComponent(this.command))}},async getRequest(t){var i;this.button.label=(i=this.progress)!=null?i:`${this.label} \u2026`,this.button.state="is-running";const{label:e,status:n,reload:c,open:o,download:r,clipboard:l,success:u,error:s}=await this.$api.get(t);n===200?this.button.label=u!=null?u:this.success:this.button.label=s!=null?s:this.error,e&&(this.button.label=e),n?this.button.state=n===200?"is-success":"has-error":this.button.state="has-response",c&&location.reload(),o&&(this.intab?(this.urlRequest=o,this.$nextTick(()=>{this.simulateClick(this.$refs.tabAnchor)})):location.href=o),r&&(this.downloadRequest=r,this.$nextTick(()=>{this.simulateClick(this.$refs.downloadAnchor)})),l?(this.clipboardRequest=l,this.button.label=this.progress,this.button.state="is-success",setTimeout(this.resetButton,this.cooldown),this.$nextTick(()=>{this.copyToClipboard(this.clipboardRequest)})):setTimeout(this.resetButton,this.cooldown)},resetButton(){this.button.label=null,this.button.state=null},simulateClick(t){const e=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(e)},async copyToClipboard(t){try{await navigator.clipboard.writeText(t)}catch{console.error("navigator.clipboard is not available")}}}},d={};var _=v(g,p,m,!1,w,null,null,null);function w(t){for(let e in d)this[e]=d[e]}var C=function(){return _.exports}();window.panel.plugin("bnomei/janitor",{fields:{janitor:C},icons:{janitorLoader:'<g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" stroke-width="1.75"><circle cx="7" cy="7" r="7.2" stroke="#000" stroke-opacity=".2"/><path d="M14.2,7c0-4-3.2-7.2-7.2-7.2" stroke="#000"><animateTransform attributeName="transform" type="rotate" from="0 7 7" to="360 7 7" dur="1s" repeatCount="indefinite"/></path></g></g>'}})})();})();
